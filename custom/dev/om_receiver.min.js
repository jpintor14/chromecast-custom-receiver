class e{constructor(){this.chromecastChannel="urn:x-cast:com.optm.anhplayer",this.licenseUrl="https://cc.orangetv.orange.es/mob/api/rtv/v1/drm",this.rightTvUrl="https://cc.orangetv.orange.es/mob/api/rtv/v1",this.loginUri="Login",this.markPositionUri="MarkPosition",this.markRecordingPositionUri="MarkRecordingPosition",this.compassUrl="https://cc.orangetv.orange.es/mob/api/reco/v1",this.sessionManagerUrl="https://cc.orangetv.orange.es/mob/api/sm/v1",this.openSessionUri="openSession",this.closeSessionUri="closeSession",this.sessionManagerId="",this.sessionManagerInterval=6e4,this.markPositionInterval=6e4,this.chromecastSerialId="",this.terminalId="",this.username="",this.householdId="",this.channelId="",this.programId="",this.recordingId="",this.contentId="",this.contentType="",this.customData="",this.playingUrl="",this.contentImage="",this.contentTitle="",this.defaultAudio="spa",this.defaultSubtitles="",this.channelFingerprint=!1,this.periodFingerprint=0,this.durationFingerprint=0,this.coordinatesFingerprint=[]}getChannel(){return this.chromecastChannel}getLicenseUrl(){return this.licenseUrl}getContentInfo(){return{id:this.contentId,type:this.contentType,licenseUrl:this.licenseUrl,customData:this.customData,channelId:this.channelId,programId:this.programId,recordingId:this.recordingId,sessionManagerId:this.sessionManagerId,contentImage:this.contentImage,contentTitle:this.contentTitle,deafultAudio:this.defaultAudio,defaultSubtitles:this.defaultSubtitles,householdId:this.householdId,terminalId:this.terminalId}}setLicenseUrl(e){this.licenseUrl=e}isPlayingLive(){return"live"==this.contentType}isPlayingCatchup(){return"catchup"==this.contentType}isPlayingNpvr(){return"npvr"==this.contentType}isPlayingTrailer(){return"TRAILER"==this.contentType}hasFingerprint(){return this.channelFingerprint}getFingerprintDuration(){return this.durationFingerprint}getFingerprintPeriod(){return this.periodFingerprint}getRandomFingerprintPosition(){if(this.coordinatesFingerprint.length>0){var e=Math.floor(Math.random()*this.coordinatesFingerprint.length);return this.coordinatesFingerprint[e]}return{horizontal:0,vertical:0}}getHouseholdId(){return this.householdId}initSessionParams(e){if(this.householdId=e.householdId,this.terminalId=e.terminalId,this.contentId=e.contentId,this.channelId=e.channelId,this.programId=e.programId,this.recordingId=e.recordingId,this.contentType=e.contentType,this.sessionManagerId=e.sessionManagerId,this.sessionManagerInterval=e.sessionManagerInterval,this.chromecastSerialId=e.chromecastSerialId,this.customData=e.customData,this.playingUrl=e.playingUrl,this.contentImage=e.contentImage,this.contentTitle=e.contentTitle,this.markPositionInterval=e.markPositionInterval,this.channelFingerprint=e.channelFingerprint,this.channelFingerprint){if(this.durationFingerprint=1e3*e.durationFingerprint,this.periodFingerprint=1e3*e.periodFingerprint,null!=e.positionsFingerprint){this.coordinatesFingerprint=[];for(var t=e.positionsFingerprint.split(";"),r=0;r<t.length;r++){var a=t[r].split("|");if(a.length>1){var s={horizontal:a[0],vertical:a[1]};this.coordinatesFingerprint.push(s)}}}}else this.durationFingerprint=0,this.periodFingerprint=0,this.coordinatesFingerprint=0;null!=e.defaultAudio&&""!=e.defaultAudio&&(this.defaultAudio=e.defaultAudio),null!=e.defaultSubtitles&&""!=e.defaultSubtitles&&(this.defaultSubtitles=e.defaultSubtitles)}login(e){this.username=e.username;var t=this.rightTvUrl+"/"+this.loginUri+"?client=json",r="username="+this.username+"&password="+e.password;this.request(t,"POST",r,null)}markPosition(e){if(console.log("CUSTOM LOG: wasabi markPosition: "+e),console.log("CUSTOM LOG: isPlayingLive: "+this.isPlayingLive()),!this.isPlayingLive()&&!this.isPlayingTrailer()){var t="",r="";this.isPlayingNpvr()?(t="recording_id="+this.recordingId+"&position="+e,r=this.rightTvUrl+"/"+this.markRecordingPositionUri+"?client=json&"+t):this.isPlayingCatchup()?null!=this.contentId&&""!=this.contentId&&this.contentId!=this.channelId?(t="video_external_id="+this.contentId+"&position="+e,r=this.rightTvUrl+"/"+this.markPositionUri+"?client=json&"+t):(t="program_external_id="+this.programId+"&channel_external_id="+this.channelId+"&position="+e,r=this.rightTvUrl+"/"+this.markRecordingPositionUri+"?client=json&"+t):(t="video_external_id="+this.contentId+"&position="+e,r=this.rightTvUrl+"/"+this.markPositionUri+"?client=json&"+t),this.request(r,"GET",null,null)}}getUsername(){return this.username}getSessionManagerInterval(){return this.sessionManagerInterval}getMarkPositionInterval(){return this.markPositionInterval}openSession(){if(!this.isPlayingTrailer()){var e="&type="+this.contentType+"&deviceId="+this.terminalId+"&contentId="+this.contentId;null!=this.sessionManagerId&&(e+="&externalSessionId="+this.sessionManagerId);var t=this.sessionManagerUrl+"/"+this.openSessionUri+"?client=json"+e;this.request(t,"GET",null,null)}}closeSession(){var e="&type="+this.contentType+"&deviceId="+this.terminalId+"&contentId="+this.contentId+"&externalSessionId="+this.sessionManagerId,t=this.sessionManagerUrl+"/"+this.closeSessionUri+"?client=json"+e;this.request(t,"GET",null,null)}request(e,t,r,a){var s=new XMLHttpRequest;s.open(t,e,!0),s.withCredentials=!0,null!=r?(s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(r)):s.send(),s.onreadystatechange=function(){4==this.readyState&&(200==this.status?null!=a&&a():console.log("CUSTOM LOG: else response: "+s.responseText))}}getDefaultAudioLanguage(){return this.defaultAudio}getDefaultSubtitlesLanguage(){return this.defaultSubtitles}getLanguageLabel(e){if(null!=e&&""!=e){var t="lang."+e;if(null!=languages[t])return languages[t]}return e}}const t=new e,r=t.getChannel(),a=t.getLicenseUrl(),s=cast.framework.CastReceiverContext.getInstance(),n=s.getPlayerManager();var i="",o="",l="",d=0,c=null,g=null,E=null,h=null,u="eng",m="spa";const I=new cast.framework.CastReceiverOptions;I.customNamespaces={[r]:cast.framework.system.MessageType.JSON},n.setMediaPlaybackInfoHandler((e,t)=>(e.media.startAbsoluteTime&&(console.log("startAbsoluteTime:"+e.media.startAbsoluteTime),d=e.media.startAbsoluteTime),e.media.customData&&(e.media.customData.token?t.licenseCustomData=e.media.customData.token:t.licenseCustomData=e.media.customData),t)),n.addEventListener(cast.framework.events.EventType.PLAYER_LOAD_COMPLETE,e=>{n.play(),N(),f(),O(e.media.tracks),y(e.media.tracks),M(),R(),e.media.startAbsoluteTime&&n.seek(e.media.startAbsoluteTime),v(),p()}),n.addEventListener(cast.framework.events.EventType.SEEKED,e=>{A()}),n.addEventListener(cast.framework.events.EventType.ENDED,e=>{w()}),n.addEventListener(cast.framework.events.EventType.REQUEST_STOP,e=>{w()}),n.addEventListener(cast.framework.events.EventType.LIVE_ENDED,e=>{n.stop(),w()}),n.setMessageInterceptor(cast.framework.messages.MessageType.EDIT_AUDIO_TRACKS,e=>{for(var r=0;r<e.tracks;r++)"AUDIO"==e.tracks[r].type&&(e.tracks[r].name=t.getLanguageName(e.tracks[r].name))}),s.addEventListener(cast.framework.system.EventType.SENDER_CONNECTED,e=>{l=e.senderId,v()});const T=new cast.framework.PlaybackConfig;function _(e,t){var r="Message received from ["+t+"],   command: "+message.command+" text: "+e.text;console.log(r)}function v(){s.sendCustomMessage(r,l,"test")}function p(){"stov"==t.getContentInfo().type&&n.seek(0)}function k(){var e={command:"sessionParams",data:t.getContentInfo()};s.sendCustomMessage(r,l,e)}function f(){null!=c&&D(),S(),c=setInterval(S,t.getSessionManagerInterval())}function S(){t.openSession(t)}function D(){t.closeSession(),clearInterval(c)}function N(){null!=g&&clearInterval(g),t.isPlayingLive()||t.isPlayingTrailer()||(A(),g=setInterval(A,t.getMarkPositionInterval()))}function A(){if(!t.isPlayingLive()&&!t.isPlayingTrailer()){var e=1e3*parseInt(n.getCurrentTimeSec());t.markPosition(e)}}function O(e){if("qaa"==t.getDefaultAudioLanguage()){for(var r=!1,a=0;a<e.length;a++)"AUDIO"==e[a].type&&e[a].language==t.getDefaultAudioLanguage()&&(n.getAudioTracksManager().setActiveByLanguage(e[a].language),r=!0);if(!r)for(a=0;a<e.length;a++)"AUDIO"==e[a].type&&e[a].language==u&&(n.getAudioTracksManager().setActiveByLanguage(e[a].language),r=!0);if(!r)for(a=0;a<e.length;a++)r||"AUDIO"!=e[a].type||e[a].language==m||(n.getAudioTracksManager().setActiveByLanguage(e[a].language),r=!0)}else for(a=0;a<e.length;a++)"AUDIO"==e[a].type&&e[a].language==t.getDefaultAudioLanguage()&&n.getAudioTracksManager().setActiveByLanguage(e[a].language)}function y(e){if("qaa"==t.getDefaultSubtitlesLanguage()){for(var r=!1,a=0;a<e.length;a++)"TEXT"==e[a].type&&e[a].language==t.getDefaultSubtitlesLanguage()&&(n.getTextTracksManager().setActiveByLanguage(e[a].language),r=!0);if(!r)for(a=0;a<e.length;a++)"TEXT"==e[a].type&&e[a].language==u&&(n.getTextTracksManager().setActiveByLanguage(e[a].language),r=!0);if(!r)for(a=0;a<e.length;a++)r||"TEXT"!=e[a].type||e[a].language==m||(n.getTextTracksManager().setActiveByLanguage(e[a].language),r=!0)}else for(a=0;a<e.length;a++)"TEXT"==e[a].type&&e[a].language==t.getDefaultSubtitlesLanguage()&&n.getTextTracksManager().setActiveByLanguage(e[a].language)}function M(){for(var e=n.getAudioTracksManager().getTracks(),r=0;r<e.length;r++)e[r].name=t.getLanguageLabel(e[r].language)}function R(){for(var e=n.getTextTracksManager().getTracks(),r=0;r<e.length;r++)e[r].name=t.getLanguageLabel(e[r].language)}function w(){D(),null!=g&&clearInterval(g),P();s.sendCustomMessage(r,l,{command:"playEnded"})}function L(){clearTimeout(h),clearTimeout(E),t.hasFingerprint()?C():P()}function C(){if(t.hasFingerprint()){var e=t.getRandomFingerprintPosition(),r=screen.width*(e.horizontal/100),a=screen.height*(e.vertical/100);e.horizontal>50&&(r-=document.getElementById("fingerprint").offsetWidth),e.vertical>50&&(a-=document.getElementById("fingerprint").offsetHeight),document.getElementById("fingerprint").style.marginLeft=r+"px",document.getElementById("fingerprint").style.marginTop=a+"px",document.getElementById("fingerprint").style.visibility="visible",document.getElementById("fingerprint").innerHTML=t.getHouseholdId(),b()}}function P(){document.getElementById("fingerprint").style.visibility="hidden",t.hasFingerprint()&&U()}function b(){h=setTimeout(P,t.getFingerprintDuration())}function U(){E=setTimeout(C,t.getFingerprintPeriod())}function F(e){let t=document.getElementsByTagName("cast-media-player")[0];null!=e.slideshow_1&&t.style.setProperty("--slideshow-image-1","url("+e.slideshow_1+")"),null!=e.slideshow_2&&t.style.setProperty("--slideshow-image-2","url("+e.slideshow_2+")"),null!=e.slideshow_3&&t.style.setProperty("--slideshow-image-3","url("+e.slideshow_3+")"),null!=e.slideshow_4&&t.style.setProperty("--slideshow-image-4","url("+e.slideshow_4+")"),null!=e.slideshow_5&&t.style.setProperty("--slideshow-image-5","url("+e.slideshow_5+")"),null!=e.slideshow_6&&t.style.setProperty("--slideshow-image-6","url("+e.slideshow_6+")"),null!=e.slideshow_7&&t.style.setProperty("--slideshow-image-7","url("+e.slideshow_7+")"),null!=e.slideshow_8&&t.style.setProperty("--slideshow-image-8","url("+e.slideshow_8+")"),null!=e.slideshow_9&&t.style.setProperty("--slideshow-image-9","url("+e.slideshow_9+")"),null!=e.slideshow_10&&t.style.setProperty("--slideshow-image-10","url("+e.slideshow_10+")")}T.autoResumeDuration=5,T.licenseUrl=a,n.addEventListener(cast.framework.events.EventType.ERROR,e=>{var a="",i="";switch(console.error("Error "+cast.framework.events.EventType.ERROR),e.detailedErrorCode){case cast.framework.events.DetailedErrorCode.MEDIA_UNKNOWN:a="MEDIA_UNKNOWN",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode+" MediaError code from the video element = "+e.error.shakaErrorData[0]+" Description is "+e.error.shakaErrorData[2]);break;case cast.framework.events.DetailedErrorCode.MEDIA_ABORTED:a="MEDIA_ABORTED";break;case cast.framework.events.DetailedErrorCode.MEDIA_DECODE:a="MEDIA_DECODE";break;case cast.framework.events.DetailedErrorCode.MEDIA_NETWORK:a="MEDIA_NETWORK";break;case cast.framework.events.DetailedErrorCode.MEDIA_SRC_NOT_SUPPORTED:a="MEDIA_SRC_NOT_SUPPORTED";break;case cast.framework.events.DetailedErrorCode.SOURCE_BUFFER_FAILURE:a="SOURCE_BUFFER_FAILURE";break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_UNKNOWN:a="MEDIAKEYS_UNKNOWN",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode);break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_NETWORK:a="MEDIAKEYS_NETWORK";break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_UNSUPPORTED:a="MEDIAKEYS_UNSUPPORTED";break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_WEBCRYPTO:a="MEDIAKEYS_WEBCRYPTO";break;case cast.framework.events.DetailedErrorCode.NETWORK_UNKNOWN:a="NETWORK_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.SEGMENT_NETWORK:a="SEGMENT_NETWORK";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_MASTER_PLAYLIST:a="HLS_NETWORK_MASTER_PLAYLIST";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_PLAYLIST:a="HLS_NETWORK_PLAYLIST";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_NO_KEY_RESPONSE:a="HLS_NETWORK_NO_KEY_RESPONSE";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_KEY_LOAD:a="HLS_NETWORK_KEY_LOAD";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_INVALID_SEGMENT:a="HLS_NETWORK_INVALID_SEGMENT";break;case cast.framework.events.DetailedErrorCode.HLS_SEGMENT_PARSING:a="HLS_SEGMENT_PARSING";break;case cast.framework.events.DetailedErrorCode.DASH_NETWORK:a="DASH_NETWORK",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode+" url = "+e.error.shakaErrorData[0]);break;case cast.framework.events.DetailedErrorCode.DASH_NO_INIT:a="DASH_NO_INIT";break;case cast.framework.events.DetailedErrorCode.SMOOTH_NETWORK:a="SMOOTH_NETWORK";break;case cast.framework.events.DetailedErrorCode.SMOOTH_NO_MEDIA_DATA:a="SMOOTH_NO_MEDIA_DATA";break;case cast.framework.events.DetailedErrorCode.MANIFEST_UNKNOWN:a="MANIFEST_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.HLS_MANIFEST_MASTER:a="HLS_MANIFEST_MASTER";break;case cast.framework.events.DetailedErrorCode.HLS_MANIFEST_PLAYLIST:a="HLS_MANIFEST_PLAYLIST";break;case cast.framework.events.DetailedErrorCode.DASH_MANIFEST_UNKNOWN:a="DASH_MANIFEST_UNKNOWN",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode);break;case cast.framework.events.DetailedErrorCode.DASH_MANIFEST_NO_PERIODS:a="MEDIA_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.MEDIA_UNKNOWN:a="DASH_MANIFEST_NO_PERIODS";break;case cast.framework.events.DetailedErrorCode.DASH_MANIFEST_NO_MIMETYPE:a="DASH_MANIFEST_NO_MIMETYPE";break;case cast.framework.events.DetailedErrorCode.DASH_INVALID_SEGMENT_INFO:a="DASH_INVALID_SEGMENT_INFO";break;case cast.framework.events.DetailedErrorCode.SMOOTH_MANIFEST:a="SMOOTH_MANIFEST";break;case cast.framework.events.DetailedErrorCode.SEGMENT_UNKNOWN:a="SEGMENT_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.TEXT_UNKNOWN:a="TEXT_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.APP:a="APP";break;case cast.framework.events.DetailedErrorCode.BREAK_CLIP_LOADING_ERROR:a="BREAK_CLIP_LOADING_ERROR";break;case cast.framework.events.DetailedErrorCode.BREAK_SEEK_INTERCEPTOR_ERROR:a="BREAK_SEEK_INTERCEPTOR_ERROR";break;case cast.framework.events.DetailedErrorCode.IMAGE_ERROR:a="IMAGE_ERROR";break;case cast.framework.events.DetailedErrorCode.LOAD_INTERRUPTED:a="LOAD_INTERRUPTED";break;case cast.framework.events.DetailedErrorCode.LOAD_FAILED:a="LOAD_FAILED";break;case cast.framework.events.DetailedErrorCode.MEDIA_ERROR_MESSAGE:a="MEDIA_ERROR_MESSAGE",void 0!==e.error.requestId&&console.log("error.requestId: "+e.error.requestId),void 0!==e.error.type&&console.log("error.type: "+e.error.type);break;case cast.framework.events.DetailedErrorCode.GENERIC:a="GENERIC";break;default:a="Unexpected error code"}console.log("on ERROR: "+a+"("+i+")");var o={type:"playbackerror"};o.errorCode=e.detailedErrorCode,o.errorCodeAsStr=a+". "+i,s.sendCustomMessage(r,void 0,o),n.getPlayerState()!==cast.framework.messages.PlayerState.IDLE&&n.stop(),s.stop(),t.closeSession()}),s.addCustomMessageListener(r,function(e){var r=e.data,a=r.command,s=r.params;switch(a){case"slideshow":F(s);break;case"login":t.login(s);break;case"sessionParams":t.initSessionParams(s),L();break;case"requestSessionParams":k();break;default:_(s,a)}}),I.playbackConfig=T,s.start(I);