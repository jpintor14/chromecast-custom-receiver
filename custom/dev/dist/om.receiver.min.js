class e{constructor(){this.chromecastChannel="urn:x-cast:com.optm.anhplayer",this.licenseUrl="https://cc.orangetv.orange.es/mob/api/rtv/v1/drm",this.rightTvUrl="https://cc.orangetv.orange.es/mob/api/rtv/v1",this.loginUri="Login",this.markPositionUri="MarkPosition",this.markRecordingPositionUri="MarkRecordingPosition",this.compassUrl="https://cc.orangetv.orange.es/mob/api/reco/v1",this.sessionManagerUrl="https://cc.orangetv.orange.es/mob/api/sm/v1",this.openSessionUri="openSession",this.closeSessionUri="closeSession",this.sessionManagerId="",this.sessionManagerInterval=6e4,this.sessionAlreadyOpen=!1,this.markPositionInterval=6e4,this.chromecastSerialId="",this.terminalId="",this.username="",this.householdId="",this.channelId="",this.programId="",this.recordingId="",this.contentId="",this.contentType="",this.customData="",this.playingUrl="",this.contentImage="",this.contentTitle="",this.defaultAudio="spa",this.defaultSubtitles="",this.channelFingerprint=!1,this.periodFingerprint=0,this.durationFingerprint=0,this.backgroundColorFingerprint="black",this.foregroundColorFingerprint="white",this.borderColorFingerprint="transparent",this.coordinatesFingerprint=[]}getChannel(){return this.chromecastChannel}getLicenseUrl(){return this.licenseUrl}getContentInfo(){return{id:this.contentId,type:this.contentType,licenseUrl:this.licenseUrl,customData:this.customData,channelId:this.channelId,programId:this.programId,recordingId:this.recordingId,sessionManagerId:this.sessionManagerId,contentImage:this.contentImage,contentTitle:this.contentTitle,deafultAudio:this.defaultAudio,defaultSubtitles:this.defaultSubtitles,householdId:this.householdId,terminalId:this.terminalId}}setLicenseUrl(e){this.licenseUrl=e}getSessionManagerId(){return this.sessionManagerId}getLiveContentType(){return"live"}isPlayingLive(){return"live"==this.contentType}isPlayingStov(){return"stov"==this.contentType}isPlayingCatchup(){return"catchup"==this.contentType}isPlayingNpvr(){return"npvr"==this.contentType}isPlayingTrailer(){return"TRAILER"==this.contentType}hasFingerprint(){return this.channelFingerprint}getFingerprintDuration(){return this.durationFingerprint}getFingerprintPeriod(){return this.periodFingerprint}getFingerprintBackgroundColor(){return this.backgroundColorFingerprint}getFingerprintForegroundColor(){return this.foregroundColorFingerprint}getFingerprintBorderColor(){return this.borderColorFingerprint}getRandomFingerprintPosition(){if(this.coordinatesFingerprint.length>0){var e=Math.floor(Math.random()*this.coordinatesFingerprint.length);return this.coordinatesFingerprint[e]}return{horizontal:0,vertical:0}}getHouseholdId(){return this.householdId}initSessionParams(e){if(this.householdId=e.householdId,this.terminalId=e.terminalId,this.contentId=e.contentId,this.channelId=e.channelId,this.programId=e.programId,this.recordingId=e.recordingId,this.contentType=e.contentType,this.sessionManagerId=e.sessionManagerId,this.sessionManagerInterval=e.sessionManagerInterval,this.chromecastSerialId=e.chromecastSerialId,this.customData=e.customData,this.playingUrl=e.playingUrl,this.contentImage=e.contentImage,this.contentTitle=e.contentTitle,this.markPositionInterval=e.markPositionInterval,this.channelFingerprint=e.channelFingerprint,this.channelFingerprint){if(this.durationFingerprint=1e3*e.durationFingerprint,this.periodFingerprint=1e3*e.periodFingerprint,null!=e.backgroundColorFingerprint&&(this.backgroundColorFingerprint=e.backgroundColorFingerprint),null!=e.foregroundColorFingerprint&&(this.foregroundColorFingerprint=e.foregroundColorFingerprint),null!=e.brderColorFingerprint&&(this.borderColorFingerprint=e.borderColorFingerprint),null!=e.positionsFingerprint){this.coordinatesFingerprint=[];for(var t=e.positionsFingerprint.split(";"),r=0;r<t.length;r++){var n=t[r].split("|");if(n.length>1){var s={horizontal:n[0],vertical:n[1]};this.coordinatesFingerprint.push(s)}}}}else this.durationFingerprint=0,this.periodFingerprint=0,this.coordinatesFingerprint=0;null!=e.defaultAudio&&""!=e.defaultAudio&&(this.defaultAudio=e.defaultAudio),null!=e.defaultSubtitles&&""!=e.defaultSubtitles&&(this.defaultSubtitles=e.defaultSubtitles)}login(e){this.username=e.username;var t=this.rightTvUrl+"/"+this.loginUri+"?client=json",r="username="+this.username+"&password="+e.password;this.request(t,"POST",r,null)}markPosition(e){if(console.log("CUSTOM LOG: wasabi markPosition: "+e),console.log("CUSTOM LOG: isPlayingLive: "+this.isPlayingLive()),!this.isPlayingLive()&&!this.isPlayingTrailer()){var t="",r="";this.isPlayingNpvr()?(t="recording_id="+this.recordingId+"&position="+e,r=this.rightTvUrl+"/"+this.markRecordingPositionUri+"?client=json&"+t):this.isPlayingCatchup()?null!=this.contentId&&""!=this.contentId&&this.contentId!=this.channelId?(t="video_external_id="+this.contentId+"&position="+e,r=this.rightTvUrl+"/"+this.markPositionUri+"?client=json&"+t):(t="program_external_id="+this.programId+"&channel_external_id="+this.channelId+"&position="+e,r=this.rightTvUrl+"/"+this.markRecordingPositionUri+"?client=json&"+t):(t="video_external_id="+this.contentId+"&position="+e,r=this.rightTvUrl+"/"+this.markPositionUri+"?client=json&"+t),this.request(r,"GET",null,null)}}getUsername(){return this.username}getSessionManagerInterval(){return this.sessionManagerInterval}getMarkPositionInterval(){return this.markPositionInterval}openSession(){if(null!=this.sessionManagerId&&""!=this.sessionManagerId&&!this.isPlayingTrailer()){var e=this.contentType;this.isPlayingStov()&&(e=this.getLiveContentType());var t="&type="+e+"&deviceId="+this.terminalId;this.isPlayingNpvr()?t+="&contentId="+this.recordingId:this.isPlayingLive()||this.isPlayingStov()?t+="&contentId="+this.channelId:this.isPlayingCatchup()?t+="&contentId="+this.programId:t+="&contentId="+this.contentId,t+="&externalSessionId="+this.sessionManagerId;var r=this.sessionManagerUrl+"/"+this.openSessionUri+"?client=json"+t;this.request(r,"GET",null,null),this.sessionAlreadyOpen=!0}}closeSession(){if(null!=this.sessionManagerId&&""!=this.sessionManagerId&&!this.isPlayingTrailer()&&this.sessionAlreadyOpen){this.sessionAlreadyOpen=!1;var e=this.contentType;this.isPlayingStov()&&(e=this.getLiveContentType());var t="&type="+e+"&deviceId="+this.terminalId+"&externalSessionId="+this.sessionManagerId;this.isPlayingNpvr()?t+="&contentId="+this.recordingId:this.isPlayingLive()||this.isPlayingStov()?t+="&contentId="+this.channelId:this.isPlayingCatchup()?t+="&contentId="+this.programId:t+="&contentId="+this.contentId;var r=this.sessionManagerUrl+"/"+this.closeSessionUri+"?client=json"+t;this.request(r,"GET",null,null)}}request(e,t,r,n){var s=new XMLHttpRequest;s.open(t,e,!0),s.withCredentials=!0,null!=r?(s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(r)):s.send(),s.onreadystatechange=function(){4==this.readyState&&(200==this.status?null!=n&&n():console.log("CUSTOM LOG: else response: "+s.responseText))}}getDefaultAudioLanguage(){return this.defaultAudio}getDefaultSubtitlesLanguage(){return this.defaultSubtitles}getLanguageLabel(e){if(null!=e&&""!=e){var t="lang."+e;if(null!=languages[t])return languages[t]}return e}}const t=new e,r=t.getChannel(),n=t.getLicenseUrl(),s=cast.framework.CastReceiverContext.getInstance(),a=s.getPlayerManager();var i="",o="",l="",d=0,g=null,c=null,h=null,u=null,E="eng",m="spa";const I=new cast.framework.CastReceiverOptions;I.customNamespaces={[r]:cast.framework.system.MessageType.JSON},a.setMediaPlaybackInfoHandler((e,t)=>(e.media.startAbsoluteTime&&(console.log("startAbsoluteTime:"+e.media.startAbsoluteTime),d=e.media.startAbsoluteTime),e.media.customData&&(e.media.customData.token?t.licenseCustomData=e.media.customData.token:t.licenseCustomData=e.media.customData),t)),a.addEventListener(cast.framework.events.EventType.PLAYER_LOAD_COMPLETE,e=>{a.play(),y(),f(),A(e.media.tracks),C(e.media.tracks),M(),O(),e.media.startAbsoluteTime&&a.seek(e.media.startAbsoluteTime),v(),_()}),a.addEventListener(cast.framework.events.EventType.SEEKED,e=>{N()}),a.addEventListener(cast.framework.events.EventType.ENDED,e=>{R()}),a.addEventListener(cast.framework.events.EventType.REQUEST_STOP,e=>{R()}),a.addEventListener(cast.framework.events.EventType.LIVE_ENDED,e=>{a.stop(),R()}),a.setMessageInterceptor(cast.framework.messages.MessageType.EDIT_AUDIO_TRACKS,e=>{for(var r=0;r<e.tracks;r++)"AUDIO"==e.tracks[r].type&&(e.tracks[r].name=t.getLanguageName(e.tracks[r].name))}),s.addEventListener(cast.framework.system.EventType.SENDER_CONNECTED,e=>{l=e.senderId,v()});const p=new cast.framework.PlaybackConfig;function T(e,t){var r="Message received from ["+t+"],   command: "+message.command+" text: "+e.text;console.log(r)}function v(){s.sendCustomMessage(r,l,"test")}function _(){"stov"==t.getContentInfo().type&&a.seek(0)}function k(){var e={command:"sessionParams",data:t.getContentInfo()};s.sendCustomMessage(r,l,e)}function f(){null!=g&&D(),S(),g=setInterval(S,t.getSessionManagerInterval())}function S(){t.openSession(t)}function D(){t.closeSession(),clearInterval(g)}function y(){null!=c&&clearInterval(c),t.isPlayingLive()||t.isPlayingTrailer()||(N(),c=setInterval(N,t.getMarkPositionInterval()))}function N(){if(!t.isPlayingLive()&&!t.isPlayingTrailer()){var e=1e3*parseInt(a.getCurrentTimeSec());t.markPosition(e)}}function A(e){if("qaa"==t.getDefaultAudioLanguage()){for(var r=!1,n=0;n<e.length;n++)"AUDIO"==e[n].type&&e[n].language==t.getDefaultAudioLanguage()&&(a.getAudioTracksManager().setActiveByLanguage(e[n].language),r=!0);if(!r)for(n=0;n<e.length;n++)"AUDIO"==e[n].type&&e[n].language==E&&(a.getAudioTracksManager().setActiveByLanguage(e[n].language),r=!0);if(!r)for(n=0;n<e.length;n++)r||"AUDIO"!=e[n].type||e[n].language==m||(a.getAudioTracksManager().setActiveByLanguage(e[n].language),r=!0)}else for(n=0;n<e.length;n++)"AUDIO"==e[n].type&&e[n].language==t.getDefaultAudioLanguage()&&a.getAudioTracksManager().setActiveByLanguage(e[n].language)}function C(e){if("qaa"==t.getDefaultSubtitlesLanguage()){for(var r=!1,n=0;n<e.length;n++)"TEXT"==e[n].type&&e[n].language==t.getDefaultSubtitlesLanguage()&&(a.getTextTracksManager().setActiveByLanguage(e[n].language),r=!0);if(!r)for(n=0;n<e.length;n++)"TEXT"==e[n].type&&e[n].language==E&&(a.getTextTracksManager().setActiveByLanguage(e[n].language),r=!0);if(!r)for(n=0;n<e.length;n++)r||"TEXT"!=e[n].type||e[n].language==m||(a.getTextTracksManager().setActiveByLanguage(e[n].language),r=!0)}else for(n=0;n<e.length;n++)"TEXT"==e[n].type&&e[n].language==t.getDefaultSubtitlesLanguage()&&a.getTextTracksManager().setActiveByLanguage(e[n].language)}function M(){for(var e=a.getAudioTracksManager().getTracks(),r=0;r<e.length;r++)e[r].name=t.getLanguageLabel(e[r].language)}function O(){for(var e=a.getTextTracksManager().getTracks(),r=0;r<e.length;r++)e[r].name=t.getLanguageLabel(e[r].language)}function R(){D(),null!=c&&clearInterval(c),w();s.sendCustomMessage(r,l,{command:"playEnded"})}function P(){clearTimeout(u),clearTimeout(h),t.hasFingerprint()?(b(),L()):w()}function L(){t.hasFingerprint()?(U(),b(),F(),document.getElementById("fingerprint").style.visibility="visible",K()):document.getElementById("fingerprint").style.visibility="hidden"}function w(){document.getElementById("fingerprint").style.visibility="hidden",t.hasFingerprint()&&H()}function b(){document.getElementById("fingerprint").style.backgroundColor=t.getFingerprintBackgroundColor(),document.getElementById("fingerprint").style.color=t.getFingerprintForegroundColor(),document.getElementById("fingerprint").style.border="thin solid "+t.getFingerprintBorderColor()}function F(){document.getElementById("fingerprint").innerHTML=t.getHouseholdId()}function U(){var e=t.getRandomFingerprintPosition(),r=screen.width*(e.horizontal/100),n=screen.height*(e.vertical/100);e.horizontal>50&&(r-=document.getElementById("fingerprint").offsetWidth),e.vertical>50&&(n-=document.getElementById("fingerprint").offsetHeight),document.getElementById("fingerprint").style.marginLeft=r+"px",document.getElementById("fingerprint").style.marginTop=n+"px"}function K(){u=setTimeout(w,t.getFingerprintDuration())}function H(){h=setTimeout(L,t.getFingerprintPeriod())}function W(e){let t=document.getElementsByTagName("cast-media-player")[0];null!=e.slideshow_1&&t.style.setProperty("--slideshow-image-1","url("+e.slideshow_1+")"),null!=e.slideshow_2&&t.style.setProperty("--slideshow-image-2","url("+e.slideshow_2+")"),null!=e.slideshow_3&&t.style.setProperty("--slideshow-image-3","url("+e.slideshow_3+")"),null!=e.slideshow_4&&t.style.setProperty("--slideshow-image-4","url("+e.slideshow_4+")"),null!=e.slideshow_5&&t.style.setProperty("--slideshow-image-5","url("+e.slideshow_5+")"),null!=e.slideshow_6&&t.style.setProperty("--slideshow-image-6","url("+e.slideshow_6+")"),null!=e.slideshow_7&&t.style.setProperty("--slideshow-image-7","url("+e.slideshow_7+")"),null!=e.slideshow_8&&t.style.setProperty("--slideshow-image-8","url("+e.slideshow_8+")"),null!=e.slideshow_9&&t.style.setProperty("--slideshow-image-9","url("+e.slideshow_9+")"),null!=e.slideshow_10&&t.style.setProperty("--slideshow-image-10","url("+e.slideshow_10+")")}p.autoResumeDuration=5,p.licenseUrl=n,a.addEventListener(cast.framework.events.EventType.ERROR,e=>{var n="",i="";switch(console.error("Error "+cast.framework.events.EventType.ERROR),e.detailedErrorCode){case cast.framework.events.DetailedErrorCode.MEDIA_UNKNOWN:n="MEDIA_UNKNOWN",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode+" MediaError code from the video element = "+e.error.shakaErrorData[0]+" Description is "+e.error.shakaErrorData[2]);break;case cast.framework.events.DetailedErrorCode.MEDIA_ABORTED:n="MEDIA_ABORTED";break;case cast.framework.events.DetailedErrorCode.MEDIA_DECODE:n="MEDIA_DECODE";break;case cast.framework.events.DetailedErrorCode.MEDIA_NETWORK:n="MEDIA_NETWORK";break;case cast.framework.events.DetailedErrorCode.MEDIA_SRC_NOT_SUPPORTED:n="MEDIA_SRC_NOT_SUPPORTED";break;case cast.framework.events.DetailedErrorCode.SOURCE_BUFFER_FAILURE:n="SOURCE_BUFFER_FAILURE";break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_UNKNOWN:n="MEDIAKEYS_UNKNOWN",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode);break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_NETWORK:n="MEDIAKEYS_NETWORK";break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_UNSUPPORTED:n="MEDIAKEYS_UNSUPPORTED";break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_WEBCRYPTO:n="MEDIAKEYS_WEBCRYPTO";break;case cast.framework.events.DetailedErrorCode.NETWORK_UNKNOWN:n="NETWORK_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.SEGMENT_NETWORK:n="SEGMENT_NETWORK";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_MASTER_PLAYLIST:n="HLS_NETWORK_MASTER_PLAYLIST";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_PLAYLIST:n="HLS_NETWORK_PLAYLIST";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_NO_KEY_RESPONSE:n="HLS_NETWORK_NO_KEY_RESPONSE";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_KEY_LOAD:n="HLS_NETWORK_KEY_LOAD";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_INVALID_SEGMENT:n="HLS_NETWORK_INVALID_SEGMENT";break;case cast.framework.events.DetailedErrorCode.HLS_SEGMENT_PARSING:n="HLS_SEGMENT_PARSING";break;case cast.framework.events.DetailedErrorCode.DASH_NETWORK:n="DASH_NETWORK",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode+" url = "+e.error.shakaErrorData[0]);break;case cast.framework.events.DetailedErrorCode.DASH_NO_INIT:n="DASH_NO_INIT";break;case cast.framework.events.DetailedErrorCode.SMOOTH_NETWORK:n="SMOOTH_NETWORK";break;case cast.framework.events.DetailedErrorCode.SMOOTH_NO_MEDIA_DATA:n="SMOOTH_NO_MEDIA_DATA";break;case cast.framework.events.DetailedErrorCode.MANIFEST_UNKNOWN:n="MANIFEST_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.HLS_MANIFEST_MASTER:n="HLS_MANIFEST_MASTER";break;case cast.framework.events.DetailedErrorCode.HLS_MANIFEST_PLAYLIST:n="HLS_MANIFEST_PLAYLIST";break;case cast.framework.events.DetailedErrorCode.DASH_MANIFEST_UNKNOWN:n="DASH_MANIFEST_UNKNOWN",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode);break;case cast.framework.events.DetailedErrorCode.DASH_MANIFEST_NO_PERIODS:n="MEDIA_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.MEDIA_UNKNOWN:n="DASH_MANIFEST_NO_PERIODS";break;case cast.framework.events.DetailedErrorCode.DASH_MANIFEST_NO_MIMETYPE:n="DASH_MANIFEST_NO_MIMETYPE";break;case cast.framework.events.DetailedErrorCode.DASH_INVALID_SEGMENT_INFO:n="DASH_INVALID_SEGMENT_INFO";break;case cast.framework.events.DetailedErrorCode.SMOOTH_MANIFEST:n="SMOOTH_MANIFEST";break;case cast.framework.events.DetailedErrorCode.SEGMENT_UNKNOWN:n="SEGMENT_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.TEXT_UNKNOWN:n="TEXT_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.APP:n="APP";break;case cast.framework.events.DetailedErrorCode.BREAK_CLIP_LOADING_ERROR:n="BREAK_CLIP_LOADING_ERROR";break;case cast.framework.events.DetailedErrorCode.BREAK_SEEK_INTERCEPTOR_ERROR:n="BREAK_SEEK_INTERCEPTOR_ERROR";break;case cast.framework.events.DetailedErrorCode.IMAGE_ERROR:n="IMAGE_ERROR";break;case cast.framework.events.DetailedErrorCode.LOAD_INTERRUPTED:n="LOAD_INTERRUPTED";break;case cast.framework.events.DetailedErrorCode.LOAD_FAILED:n="LOAD_FAILED";break;case cast.framework.events.DetailedErrorCode.MEDIA_ERROR_MESSAGE:n="MEDIA_ERROR_MESSAGE",void 0!==e.error.requestId&&console.log("error.requestId: "+e.error.requestId),void 0!==e.error.type&&console.log("error.type: "+e.error.type);break;case cast.framework.events.DetailedErrorCode.GENERIC:n="GENERIC";break;default:n="Unexpected error code"}console.log("on ERROR: "+n+"("+i+")");var o={type:"playbackerror"};o.errorCode=e.detailedErrorCode,o.errorCodeAsStr=n+". "+i,s.sendCustomMessage(r,void 0,o),a.getPlayerState()!==cast.framework.messages.PlayerState.IDLE&&a.stop(),s.stop(),t.closeSession()}),s.addCustomMessageListener(r,function(e){var r=e.data,n=r.command,s=r.params;switch(n){case"slideshow":W(s);break;case"login":t.login(s);break;case"sessionParams":var a=t.getSessionManagerId();""!=a&&a!=s.sessionManagerId&&D(),t.initSessionParams(s),P();break;case"requestSessionParams":k();break;default:T(s,n)}}),I.playbackConfig=p,s.start(I);