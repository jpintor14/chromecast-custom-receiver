class e{constructor(){this.chromecastChannel="urn:x-cast:com.optm.anhplayer",this.licenseUrl="https://cc.orangetv.orange.es/mob/api/rtv/v1/drm",this.rightTvUrl="https://cc.orangetv.orange.es/mob/api/rtv/v1",this.loginUri="Login",this.markPositionUri="MarkPosition",this.markRecordingPositionUri="MarkRecordingPosition",this.compassUrl="https://cc.orangetv.orange.es/mob/api/reco/v1",this.sessionManagerUrl="https://cc.orangetv.orange.es/mob/api/sm/v1",this.openSessionUri="openSession",this.closeSessionUri="closeSession",this.sessionManagerId="",this.sessionManagerInterval=6e4,this.markPositionInterval=6e4,this.chromecastSerialId="",this.terminalId="",this.username="",this.householdId="",this.channelId="",this.programId="",this.recordingId="",this.contentId="",this.contentType="",this.customData="",this.playingUrl="",this.contentImage="",this.contentTitle="",this.defaultAudio="spa",this.defaultSubtitles="",this.channelFingerprint=!1,this.periodFingerprint=0,this.durationFingerprint=0,this.coordinatesFingerprint=[],this.fingerprintBackgroundColor="",this.fingerprintForegroundColor="",this.fingerprintBorderColor=""}getChannel(){return this.chromecastChannel}getLicenseUrl(){return this.licenseUrl}getContentInfo(){return{id:this.contentId,type:this.contentType,licenseUrl:this.licenseUrl,customData:this.customData,channelId:this.channelId,programId:this.programId,recordingId:this.recordingId,sessionManagerId:this.sessionManagerId,contentImage:this.contentImage,contentTitle:this.contentTitle,deafultAudio:this.defaultAudio,defaultSubtitles:this.defaultSubtitles,householdId:this.householdId,terminalId:this.terminalId}}setLicenseUrl(e){this.licenseUrl=e}isPlayingLive(){return"live"==this.contentType}isPlayingCatchup(){return"catchup"==this.contentType}isPlayingNpvr(){return"npvr"==this.contentType}isPlayingTrailer(){return"TRAILER"==this.contentType}hasFingerprint(){return this.channelFingerprint}getFingerprintDuration(){return this.durationFingerprint}getFingerprintBackgroundColor(){return this.fingerprintBackgroundColor}getFingerprintForegroundColor(){return this.fingerprintForegroundColor}getFingerprintBorderColor(){return this.fingerprintBorderColor}getFingerprintPeriod(){return this.periodFingerprint}getRandomFingerprintPosition(){if(this.coordinatesFingerprint.length>0){var e=Math.floor(Math.random()*this.coordinatesFingerprint.length);return this.coordinatesFingerprint[e]}return{horizontal:0,vertical:0}}getHouseholdId(){return this.householdId}initSessionParams(e){if(this.householdId=e.householdId,this.terminalId=e.terminalId,this.contentId=e.contentId,this.channelId=e.channelId,this.programId=e.programId,this.recordingId=e.recordingId,this.contentType=e.contentType,this.sessionManagerId=e.sessionManagerId,this.sessionManagerInterval=e.sessionManagerInterval,this.chromecastSerialId=e.chromecastSerialId,this.customData=e.customData,this.playingUrl=e.playingUrl,this.contentImage=e.contentImage,this.contentTitle=e.contentTitle,this.markPositionInterval=e.markPositionInterval,this.channelFingerprint=e.channelFingerprint,this.channelFingerprint){if(this.durationFingerprint=1e3*e.durationFingerprint,this.periodFingerprint=1e3*e.periodFingerprint,null!=e.fingerprintBackgroundColor&&(this.fingerprintBackgroundColor=e.fingerprintBackgroundColor),null!=e.fingerprintForegroundColor&&(this.fingerprintForegroundColor=e.fingerprintForegroundColor),null!=e.fingerprintBorderColor&&(this.fingerprintBorderColor=e.fingerprintBorderColor),null!=e.positionsFingerprint){this.coordinatesFingerprint=[];for(var r=e.positionsFingerprint.split(";"),t=0;t<r.length;t++){var a=r[t].split("|");if(a.length>1){var n={horizontal:a[0],vertical:a[1]};this.coordinatesFingerprint.push(n)}}}}else this.durationFingerprint=0,this.periodFingerprint=0,this.coordinatesFingerprint=0;null!=e.defaultAudio&&""!=e.defaultAudio&&(this.defaultAudio=e.defaultAudio),null!=e.defaultSubtitles&&""!=e.defaultSubtitles&&(this.defaultSubtitles=e.defaultSubtitles)}login(e){this.username=e.username;var r=this.rightTvUrl+"/"+this.loginUri+"?client=json",t="username="+this.username+"&password="+e.password;this.request(r,"POST",t,null)}markPosition(e){if(console.log("CUSTOM LOG: wasabi markPosition: "+e),console.log("CUSTOM LOG: isPlayingLive: "+this.isPlayingLive()),!this.isPlayingLive()&&!this.isPlayingTrailer()){var r="",t="";this.isPlayingNpvr()?(r="recording_id="+this.recordingId+"&position="+e,t=this.rightTvUrl+"/"+this.markRecordingPositionUri+"?client=json&"+r):this.isPlayingCatchup()?null!=this.contentId&&""!=this.contentId&&this.contentId!=this.channelId?(r="video_external_id="+this.contentId+"&position="+e,t=this.rightTvUrl+"/"+this.markPositionUri+"?client=json&"+r):(r="program_external_id="+this.programId+"&channel_external_id="+this.channelId+"&position="+e,t=this.rightTvUrl+"/"+this.markRecordingPositionUri+"?client=json&"+r):(r="video_external_id="+this.contentId+"&position="+e,t=this.rightTvUrl+"/"+this.markPositionUri+"?client=json&"+r),this.request(t,"GET",null,null)}}getUsername(){return this.username}getSessionManagerInterval(){return this.sessionManagerInterval}getMarkPositionInterval(){return this.markPositionInterval}openSession(){if(!this.isPlayingTrailer()){var e="&type="+this.contentType+"&deviceId="+this.terminalId+"&contentId="+this.contentId;null!=this.sessionManagerId&&(e+="&externalSessionId="+this.sessionManagerId);var r=this.sessionManagerUrl+"/"+this.openSessionUri+"?client=json"+e;this.request(r,"GET",null,null)}}closeSession(){var e="&type="+this.contentType+"&deviceId="+this.terminalId+"&contentId="+this.contentId+"&externalSessionId="+this.sessionManagerId,r=this.sessionManagerUrl+"/"+this.closeSessionUri+"?client=json"+e;this.request(r,"GET",null,null)}request(e,r,t,a){var n=new XMLHttpRequest;n.open(r,e,!0),n.withCredentials=!0,null!=t?(n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(t)):n.send(),n.onreadystatechange=function(){4==this.readyState&&(200==this.status?null!=a&&a():console.log("CUSTOM LOG: else response: "+n.responseText))}}getDefaultAudioLanguage(){return this.defaultAudio}getDefaultSubtitlesLanguage(){return this.defaultSubtitles}getLanguageLabel(e){if(null!=e&&""!=e){var r="lang."+e;if(null!=languages[r])return languages[r]}return e}}const r=new e,t=r.getChannel(),a=r.getLicenseUrl(),n=cast.framework.CastReceiverContext.getInstance(),s=n.getPlayerManager();var i="",o="",l="",d=0,g=null,c=null,u=null,h=null,E="eng",m="spa";const I=new cast.framework.CastReceiverOptions;I.customNamespaces={[t]:cast.framework.system.MessageType.JSON},s.setMediaPlaybackInfoHandler((e,r)=>(e.media.startAbsoluteTime&&(console.log("startAbsoluteTime:"+e.media.startAbsoluteTime),d=e.media.startAbsoluteTime),e.media.customData&&(e.media.customData.token?r.licenseCustomData=e.media.customData.token:r.licenseCustomData=e.media.customData),r)),s.addEventListener(cast.framework.events.EventType.PLAYER_LOAD_COMPLETE,e=>{s.play(),N(),v(),y(e.media.tracks),O(e.media.tracks),C(),M(),e.media.startAbsoluteTime&&s.seek(e.media.startAbsoluteTime),_(),f()}),s.addEventListener(cast.framework.events.EventType.SEEKED,e=>{A()}),s.addEventListener(cast.framework.events.EventType.ENDED,e=>{R()}),s.addEventListener(cast.framework.events.EventType.REQUEST_STOP,e=>{R()}),s.addEventListener(cast.framework.events.EventType.LIVE_ENDED,e=>{s.stop(),R()}),s.setMessageInterceptor(cast.framework.messages.MessageType.EDIT_AUDIO_TRACKS,e=>{for(var t=0;t<e.tracks;t++)"AUDIO"==e.tracks[t].type&&(e.tracks[t].name=r.getLanguageName(e.tracks[t].name))}),n.addEventListener(cast.framework.system.EventType.SENDER_CONNECTED,e=>{l=e.senderId,_()});const p=new cast.framework.PlaybackConfig;function T(e,r){var t="Message received from ["+r+"],   command: "+message.command+" text: "+e.text;console.log(t)}function _(){n.sendCustomMessage(t,l,"test")}function f(){"stov"==r.getContentInfo().type&&s.seek(0)}function k(){var e={command:"sessionParams",data:r.getContentInfo()};n.sendCustomMessage(t,l,e)}function v(){null!=g&&D(),S(),g=setInterval(S,r.getSessionManagerInterval())}function S(){r.openSession(r)}function D(){r.closeSession(),clearInterval(g)}function N(){null!=c&&clearInterval(c),r.isPlayingLive()||r.isPlayingTrailer()||(A(),c=setInterval(A,r.getMarkPositionInterval()))}function A(){if(!r.isPlayingLive()&&!r.isPlayingTrailer()){var e=1e3*parseInt(s.getCurrentTimeSec());r.markPosition(e)}}function y(e){if("qaa"==r.getDefaultAudioLanguage()){for(var t=!1,a=0;a<e.length;a++)"AUDIO"==e[a].type&&e[a].language==r.getDefaultAudioLanguage()&&(s.getAudioTracksManager().setActiveByLanguage(e[a].language),t=!0);if(!t)for(a=0;a<e.length;a++)"AUDIO"==e[a].type&&e[a].language==E&&(s.getAudioTracksManager().setActiveByLanguage(e[a].language),t=!0);if(!t)for(a=0;a<e.length;a++)t||"AUDIO"!=e[a].type||e[a].language==m||(s.getAudioTracksManager().setActiveByLanguage(e[a].language),t=!0)}else for(a=0;a<e.length;a++)"AUDIO"==e[a].type&&e[a].language==r.getDefaultAudioLanguage()&&s.getAudioTracksManager().setActiveByLanguage(e[a].language)}function O(e){if("qaa"==r.getDefaultSubtitlesLanguage()){for(var t=!1,a=0;a<e.length;a++)"TEXT"==e[a].type&&e[a].language==r.getDefaultSubtitlesLanguage()&&(s.getTextTracksManager().setActiveByLanguage(e[a].language),t=!0);if(!t)for(a=0;a<e.length;a++)"TEXT"==e[a].type&&e[a].language==E&&(s.getTextTracksManager().setActiveByLanguage(e[a].language),t=!0);if(!t)for(a=0;a<e.length;a++)t||"TEXT"!=e[a].type||e[a].language==m||(s.getTextTracksManager().setActiveByLanguage(e[a].language),t=!0)}else for(a=0;a<e.length;a++)"TEXT"==e[a].type&&e[a].language==r.getDefaultSubtitlesLanguage()&&s.getTextTracksManager().setActiveByLanguage(e[a].language)}function C(){for(var e=s.getAudioTracksManager().getTracks(),t=0;t<e.length;t++)e[t].name=r.getLanguageLabel(e[t].language)}function M(){for(var e=s.getTextTracksManager().getTracks(),t=0;t<e.length;t++)e[t].name=r.getLanguageLabel(e[t].language)}function R(){D(),null!=c&&clearInterval(c),P();n.sendCustomMessage(t,l,{command:"playEnded"})}function w(){clearTimeout(h),clearTimeout(u),r.hasFingerprint()?(b(),L()):P()}function L(){if(r.hasFingerprint()){var e=r.getRandomFingerprintPosition(),t=screen.width*(e.horizontal/100),a=screen.height*(e.vertical/100);e.horizontal>50&&(t-=document.getElementById("fingerprint").offsetWidth),e.vertical>50&&(a-=document.getElementById("fingerprint").offsetHeight),document.getElementById("fingerprint").style.marginLeft=t+"px",document.getElementById("fingerprint").style.marginTop=a+"px",document.getElementById("fingerprint").style.visibility="visible",document.getElementById("fingerprint").innerHTML=r.getHouseholdId(),U()}}function P(){document.getElementById("fingerprint").style.visibility="hidden",r.hasFingerprint()&&F()}function b(){document.getElementById("fingerprint").style.backgroundColor="magenta",document.getElementById("fingerprint").style.color=r.fingerprintForegroundColor,document.getElementById("fingerprint").style.border="thin solid "+r.fingerprintBorderColor}function U(){h=setTimeout(P,r.getFingerprintDuration())}function F(){u=setTimeout(L,r.getFingerprintPeriod())}function K(e){let r=document.getElementsByTagName("cast-media-player")[0];null!=e.slideshow_1&&r.style.setProperty("--slideshow-image-1","url("+e.slideshow_1+")"),null!=e.slideshow_2&&r.style.setProperty("--slideshow-image-2","url("+e.slideshow_2+")"),null!=e.slideshow_3&&r.style.setProperty("--slideshow-image-3","url("+e.slideshow_3+")"),null!=e.slideshow_4&&r.style.setProperty("--slideshow-image-4","url("+e.slideshow_4+")"),null!=e.slideshow_5&&r.style.setProperty("--slideshow-image-5","url("+e.slideshow_5+")"),null!=e.slideshow_6&&r.style.setProperty("--slideshow-image-6","url("+e.slideshow_6+")"),null!=e.slideshow_7&&r.style.setProperty("--slideshow-image-7","url("+e.slideshow_7+")"),null!=e.slideshow_8&&r.style.setProperty("--slideshow-image-8","url("+e.slideshow_8+")"),null!=e.slideshow_9&&r.style.setProperty("--slideshow-image-9","url("+e.slideshow_9+")"),null!=e.slideshow_10&&r.style.setProperty("--slideshow-image-10","url("+e.slideshow_10+")")}p.autoResumeDuration=5,p.licenseUrl=a,s.addEventListener(cast.framework.events.EventType.ERROR,e=>{var a="",i="";switch(console.error("Error "+cast.framework.events.EventType.ERROR),e.detailedErrorCode){case cast.framework.events.DetailedErrorCode.MEDIA_UNKNOWN:a="MEDIA_UNKNOWN",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode+" MediaError code from the video element = "+e.error.shakaErrorData[0]+" Description is "+e.error.shakaErrorData[2]);break;case cast.framework.events.DetailedErrorCode.MEDIA_ABORTED:a="MEDIA_ABORTED";break;case cast.framework.events.DetailedErrorCode.MEDIA_DECODE:a="MEDIA_DECODE";break;case cast.framework.events.DetailedErrorCode.MEDIA_NETWORK:a="MEDIA_NETWORK";break;case cast.framework.events.DetailedErrorCode.MEDIA_SRC_NOT_SUPPORTED:a="MEDIA_SRC_NOT_SUPPORTED";break;case cast.framework.events.DetailedErrorCode.SOURCE_BUFFER_FAILURE:a="SOURCE_BUFFER_FAILURE";break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_UNKNOWN:a="MEDIAKEYS_UNKNOWN",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode);break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_NETWORK:a="MEDIAKEYS_NETWORK";break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_UNSUPPORTED:a="MEDIAKEYS_UNSUPPORTED";break;case cast.framework.events.DetailedErrorCode.MEDIAKEYS_WEBCRYPTO:a="MEDIAKEYS_WEBCRYPTO";break;case cast.framework.events.DetailedErrorCode.NETWORK_UNKNOWN:a="NETWORK_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.SEGMENT_NETWORK:a="SEGMENT_NETWORK";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_MASTER_PLAYLIST:a="HLS_NETWORK_MASTER_PLAYLIST";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_PLAYLIST:a="HLS_NETWORK_PLAYLIST";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_NO_KEY_RESPONSE:a="HLS_NETWORK_NO_KEY_RESPONSE";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_KEY_LOAD:a="HLS_NETWORK_KEY_LOAD";break;case cast.framework.events.DetailedErrorCode.HLS_NETWORK_INVALID_SEGMENT:a="HLS_NETWORK_INVALID_SEGMENT";break;case cast.framework.events.DetailedErrorCode.HLS_SEGMENT_PARSING:a="HLS_SEGMENT_PARSING";break;case cast.framework.events.DetailedErrorCode.DASH_NETWORK:a="DASH_NETWORK",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode+" url = "+e.error.shakaErrorData[0]);break;case cast.framework.events.DetailedErrorCode.DASH_NO_INIT:a="DASH_NO_INIT";break;case cast.framework.events.DetailedErrorCode.SMOOTH_NETWORK:a="SMOOTH_NETWORK";break;case cast.framework.events.DetailedErrorCode.SMOOTH_NO_MEDIA_DATA:a="SMOOTH_NO_MEDIA_DATA";break;case cast.framework.events.DetailedErrorCode.MANIFEST_UNKNOWN:a="MANIFEST_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.HLS_MANIFEST_MASTER:a="HLS_MANIFEST_MASTER";break;case cast.framework.events.DetailedErrorCode.HLS_MANIFEST_PLAYLIST:a="HLS_MANIFEST_PLAYLIST";break;case cast.framework.events.DetailedErrorCode.DASH_MANIFEST_UNKNOWN:a="DASH_MANIFEST_UNKNOWN",void 0!==e.error&&void 0!==e.error.shakaErrorCode&&(i="ShakaPlayer error code = "+e.error.shakaErrorCode);break;case cast.framework.events.DetailedErrorCode.DASH_MANIFEST_NO_PERIODS:a="MEDIA_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.MEDIA_UNKNOWN:a="DASH_MANIFEST_NO_PERIODS";break;case cast.framework.events.DetailedErrorCode.DASH_MANIFEST_NO_MIMETYPE:a="DASH_MANIFEST_NO_MIMETYPE";break;case cast.framework.events.DetailedErrorCode.DASH_INVALID_SEGMENT_INFO:a="DASH_INVALID_SEGMENT_INFO";break;case cast.framework.events.DetailedErrorCode.SMOOTH_MANIFEST:a="SMOOTH_MANIFEST";break;case cast.framework.events.DetailedErrorCode.SEGMENT_UNKNOWN:a="SEGMENT_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.TEXT_UNKNOWN:a="TEXT_UNKNOWN";break;case cast.framework.events.DetailedErrorCode.APP:a="APP";break;case cast.framework.events.DetailedErrorCode.BREAK_CLIP_LOADING_ERROR:a="BREAK_CLIP_LOADING_ERROR";break;case cast.framework.events.DetailedErrorCode.BREAK_SEEK_INTERCEPTOR_ERROR:a="BREAK_SEEK_INTERCEPTOR_ERROR";break;case cast.framework.events.DetailedErrorCode.IMAGE_ERROR:a="IMAGE_ERROR";break;case cast.framework.events.DetailedErrorCode.LOAD_INTERRUPTED:a="LOAD_INTERRUPTED";break;case cast.framework.events.DetailedErrorCode.LOAD_FAILED:a="LOAD_FAILED";break;case cast.framework.events.DetailedErrorCode.MEDIA_ERROR_MESSAGE:a="MEDIA_ERROR_MESSAGE",void 0!==e.error.requestId&&console.log("error.requestId: "+e.error.requestId),void 0!==e.error.type&&console.log("error.type: "+e.error.type);break;case cast.framework.events.DetailedErrorCode.GENERIC:a="GENERIC";break;default:a="Unexpected error code"}console.log("on ERROR: "+a+"("+i+")");var o={type:"playbackerror"};o.errorCode=e.detailedErrorCode,o.errorCodeAsStr=a+". "+i,n.sendCustomMessage(t,void 0,o),s.getPlayerState()!==cast.framework.messages.PlayerState.IDLE&&s.stop(),n.stop(),r.closeSession()}),n.addCustomMessageListener(t,function(e){var t=e.data,a=t.command,n=t.params;switch(a){case"slideshow":K(n);break;case"login":r.login(n);break;case"sessionParams":r.initSessionParams(n),w();break;case"requestSessionParams":k();break;default:T(n,a)}}),I.playbackConfig=p,n.start(I);